<!DOCTYPE html>
<html>
<head>
  <title>Intruder Alarm Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <h1>Intruder Alarm System</h1>

  <div id="controls">
    <h2>System Controls</h2>
    <div>
      <label>ESP32-CAM:</label>
      <button id="arm-esp32">Arm</button>
      <button id="disarm-esp32">Disarm</button>
      <span id="esp32-status"></span>
    </div>
    <div>
      <label>Arduino Uno:</label>
      <button id="arm-arduino">Arm</button>
      <button id="disarm-arduino">Disarm</button>
      <span id="arduino-status"></span>
    </div>
  </div>

  <div id="alert">
    <h2>Alerts</h2>
    <div id="alert-content">No alerts.</div>
  </div>

  <a href="snapshots.html" class="btn">View Snapshots</a>

  <script>
    // TODO: Replace with your Firebase config!
    var firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://fiot-aa4f5-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "fiot-aa4f5",
      storageBucket: "fiot-aa4f5.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);

    var statusRef = firebase.database().ref("systemStatus");
    var alertRef = firebase.database().ref("alerts/lastAlert");

    // Status updates
    statusRef.child("esp32").on("value", function(snap) {
      var data = snap.val();
      document.getElementById("esp32-status").innerText =
        "Status: " + (data && data.armed ? "Armed" : "Disarmed") + ", Motion: " + (data && data.motionDetected ? "Intruder!" : "Clear");
    });
    statusRef.child("arduino").on("value", function(snap) {
      var data = snap.val();
      document.getElementById("arduino-status").innerText =
        "Status: " + (data && data.armed ? "Armed" : "Disarmed") + ", Motion: " + (data && data.motionDetected ? "Intruder!" : "Clear");
    });

    // Arm/disarm controls
    document.getElementById("arm-esp32").onclick = function() {
      statusRef.child("esp32").update({ armed: true });
    };
    document.getElementById("disarm-esp32").onclick = function() {
      statusRef.child("esp32").update({ armed: false });
    };
    document.getElementById("arm-arduino").onclick = function() {
      statusRef.child("arduino").update({ armed: true });
    };
    document.getElementById("disarm-arduino").onclick = function() {
      statusRef.child("arduino").update({ armed: false });
    };

    // Alert monitor
    alertRef.on("value", function(snap) {
      var alert = snap.val();
      if(alert && alert.type === "intruder") {
        document.getElementById("alert-content").innerHTML =
          `<b>Intruder Detected!</b> Device: ${alert.device} at ${alert.timestamp}`;
      }
    });
  </script>
</body>
</html>